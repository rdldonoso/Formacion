<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de No Conformidades BPL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .notebook {
            background: linear-gradient(135deg, #fdfbfb, #ebedee);
            border: 2px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 20px;
            width: 100%;
            max-width: 700px;
            margin: 50px auto;
        }
        .notebook-header {
            font-size: 2rem;
            text-align: center;
            font-weight: bold;
            color: #2c3e50;
        }
        .form-group label {
            font-weight: 600;
            color: #34495e;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            border: 1px solid #dfe4ea;
            border-radius: 5px;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }
        button {
            transition: all 0.2s;
        }
        button:hover {
            transform: scale(1.05);
            background-color: #2980b9;
        }
        ul li {
            border-left: 4px solid #3498db;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="notebook">
        <div class="notebook-header">Registro de No Conformidades</div>
        <form id="nonconformityForm" class="mt-5 space-y-4">
            <fieldset>
                <legend class="text-lg font-bold">Datos Generales</legend>
                <div class="form-group">
                    <label for="codigo" class="block text-sm font-medium">Código de No Conformidad:</label>
                    <input type="text" id="codigo" class="w-full border px-3 py-2" placeholder="Ingrese el código" required aria-describedby="codigoHelp">
                </div>
                <div class="form-group">
                    <label for="fecha" class="block text-sm font-medium">Fecha:</label>
                    <input type="date" id="fecha" class="w-full border px-3 py-2" required>
                </div>
                <div class="form-group">
                    <label for="usuario" class="block text-sm font-medium">Usuario:</label>
                    <input type="text" id="usuario" class="w-full border px-3 py-2" placeholder="Nombre del usuario" required>
                </div>
                <div class="form-group">
                    <label for="proceso" class="block text-sm font-medium">Proceso afectado:</label>
                    <select id="proceso" class="w-full border px-3 py-2" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Proceso/Método">Proceso/Método</option>
                        <option value="Muestra">Muestra</option>
                        <option value="Equipo">Equipo</option>
                        <option value="Instalación">Instalación</option>
                        <option value="Otros">Otros</option>
                        <option value="Estudio">Estudio</option>
                    </select>
                </div>
            </fieldset>
            <fieldset>
                <legend class="text-lg font-bold">Detalles de la No Conformidad</legend>
                <div class="form-group">
                    <label for="descripcion" class="block text-sm font-medium">Descripción de la no conformidad:</label>
                    <textarea id="descripcion" class="w-full border px-3 py-2" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="analisis" class="block text-sm font-medium">Análisis de la causa raíz:</label>
                    <textarea id="analisis" class="w-full border px-3 py-2" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="clasificacion" class="block text-sm font-medium">Clasificación de la causa raíz:</label>
                    <div class="form-group">
                        <label for="detectabilidad" class="block text-sm font-medium">Detectabilidad:</label>
                        <select id="detectabilidad" class="w-full border px-3 py-2" required>
                            <option value="">Seleccione una opción</option>
                            <option value="1">1 - Control en proceso</option>
                            <option value="2">2 - Control al final del proceso</option>
                            <option value="3">3 - No hay control implementado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gravedad" class="block text-sm font-medium">Gravedad:</label>
                        <select id="gravedad" class="w-full border px-3 py-2" required>
                            <option value="">Seleccione una opción</option>
                            <option value="1">1 - La desviación no afecta a la calidad del proceso, pero debe documentarse.</option>
                            <option value="2">2 - La desviación afecta a un atributo o parámetro no crítico para la calidad.</option>
                            <option value="3">3 - La desviación afecta a un atributo o parámetro crítico para la calidad.</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="resultadoClasificacion" class="block text-sm font-medium">Resultado:</label>
                        <input type="text" id="resultadoClasificacion" class="w-full border px-3 py-2 bg-gray-100" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label for="accion" class="block text-sm font-medium">Acción Correctiva:</label>
                    <textarea id="accion" class="w-full border px-3 py-2" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="control" class="block text-sm font-medium">Control de cambios:</label>
                    <textarea id="control" class="w-full border px-3 py-2" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="revision" class="block text-sm font-medium">Revisión de la efectividad:</label>
                    <textarea id="revision" class="w-full border px-3 py-2" rows="3"></textarea>
                </div>
            </fieldset>
            <fieldset>
                <legend class="text-lg font-bold">Resultados</legend>
                <div class="form-group">
                    <label for="resultado" class="block text-sm font-medium">Resultado de implementación y seguimiento:</label>
                    <select id="resultado" class="w-full border px-3 py-2">
                        <option value="">Seleccione una opción</option>
                        <option value="correcta-cierre">Correcta y cierre</option>
                        <option value="correcta-revision">Correcta y nueva revisión</option>
                        <option value="incorrecta-nueva">Incorrecta y nueva No Conformidad</option>
                    </select>
                </div>
            </fieldset>
            <div class="form-group">
                <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded shadow-lg">Registrar</button>
            </div>
        </form>
        <div class="mt-10">
            <h2 class="text-lg font-bold text-gray-700">No Conformidades Registradas</h2>
            <ul id="nonconformityList" class="mt-3 space-y-4"></ul>
            <button onclick="clearAllNonconformities()" class="bg-red-600 text-white px-5 py-2 rounded shadow-lg mt-5">Limpiar Todos</button>
        </div>
    </div>
    <script>
        function calculateClassification() {
            const detectabilidad = parseInt(document.getElementById("detectabilidad").value);
            const gravedad = parseInt(document.getElementById("gravedad").value);

            if (!isNaN(detectabilidad) && !isNaN(gravedad)) {
                const resultado = detectabilidad * gravedad;
                const clasificacionTexto = resultado <= 4 ? "NO Crítica" : "Crítica";
                document.getElementById("resultadoClasificacion").value = `${resultado} - ${clasificacionTexto}`;
            } else {
                document.getElementById("resultadoClasificacion").value = "";
            }
        }

        document.getElementById("detectabilidad").addEventListener("change", calculateClassification);
        document.getElementById("gravedad").addEventListener("change", calculateClassification);

        document.getElementById("nonconformityForm").addEventListener("submit", function(event) {
            event.preventDefault();
            const codigo = document.getElementById("codigo").value;
            const fecha = document.getElementById("fecha").value;
            const usuario = document.getElementById("usuario").value;
            const proceso = document.getElementById("proceso").value;
            const descripcion = document.getElementById("descripcion").value;
            const analisis = document.getElementById("analisis").value;
            const detectabilidad = parseInt(document.getElementById("detectabilidad").value);
            const gravedad = parseInt(document.getElementById("gravedad").value);
            const accion = document.getElementById("accion").value;
            const control = document.getElementById("control").value;
            const revision = document.getElementById("revision").value;
            const resultado = document.getElementById("resultado").value;

            if (!codigo || !fecha || !usuario || !proceso || !descripcion || isNaN(detectabilidad) || isNaN(gravedad)) {
                alert("Por favor complete todos los campos obligatorios.");
                return;
            }

            const clasificacionResultado = detectabilidad * gravedad;
            const clasificacionTexto = clasificacionResultado <= 4 ? "NO Crítica" : "Crítica";
            document.getElementById("resultadoClasificacion").value = `${clasificacionResultado} - ${clasificacionTexto}`;

            const nonconformity = {
                codigo,
                fecha,
                usuario,
                proceso,
                descripcion,
                analisis,
                clasificacionResultado: `${clasificacionResultado} - ${clasificacionTexto}`,
                accion,
                control,
                revision,
                resultado
            };

            let nonconformities = JSON.parse(localStorage.getItem("nonconformities")) || [];
            nonconformities.push(nonconformity);
            localStorage.setItem("nonconformities", JSON.stringify(nonconformities));
            renderNonconformities();
            document.getElementById("nonconformityForm").reset();
        });

        function renderNonconformities() {
            const nonconformities = JSON.parse(localStorage.getItem("nonconformities")) || [];
            const list = document.getElementById("nonconformityList");
            list.innerHTML = "";
            nonconformities.forEach((item, index) => {
                const li = document.createElement("li");
                li.classList.add("bg-white", "p-4", "rounded", "shadow");
                li.innerHTML = `
                    <strong>Código:</strong> ${item.codigo}<br>
                    <strong>Fecha:</strong> ${item.fecha}<br>
                    <strong>Usuario:</strong> ${item.usuario}<br>
                    <strong>Proceso afectado:</strong> ${item.proceso}<br>
                    <strong>Descripción:</strong> ${item.descripcion}<br>
                    <strong>Análisis de la causa raíz:</strong> ${item.analisis || "No especificado"}<br>
                    <strong>Clasificación:</strong> ${item.clasificacionResultado}<br>
                    <strong>Acción Correctiva:</strong> ${item.accion || "No especificada"}<br>
                    <strong>Control de cambios:</strong> ${item.control || "No especificado"}<br>
                    <strong>Revisión de la efectividad:</strong> ${item.revision || "No especificada"}<br>
                    <strong>Resultado:</strong> ${item.resultado}<br>
                    <button onclick="deleteNonconformity(${index})" class="text-red-500">Eliminar</button>
                `;
                list.appendChild(li);
            });
        }

        function deleteNonconformity(index) {
            if (!confirm("¿Estás seguro de que deseas eliminar esta no conformidad?")) return;
            let nonconformities = JSON.parse(localStorage.getItem("nonconformities")) || [];
            nonconformities.splice(index, 1);
            localStorage.setItem("nonconformities", JSON.stringify(nonconformities));
            renderNonconformities();
        }

        function clearAllNonconformities() {
            if (!confirm("¿Estás seguro de que deseas limpiar todas las no conformidades?")) return;
            localStorage.removeItem("nonconformities");
            renderNonconformities();
        }

        renderNonconformities();
    </script>
</body>
</html>

